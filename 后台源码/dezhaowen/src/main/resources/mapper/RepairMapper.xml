<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.accp.mapper.RepairMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.accp.domain.Repair">
        <id column="number" property="number" />
        <result column="carinfoId" property="carinfoId" />
        <result column="staffno" property="staffno" />
        <result column="oil" property="oil" />
        <result column="type" property="type" />
        <result column="worktime" property="worktime" />
        <result column="getman" property="getman" />
        <result column="overworkdate" property="overworkdate" />
        <result column="nowworkDate" property="nowworkDate" />
        <result column="setter" property="setter" />
        <result column="company" property="company" />
        <result column="befor" property="befor" />
        <result column="price" property="price" />
        <result column="remark" property="remark" />
        <result column="state" property="state" />
        <result column="fault" property="fault" />
        <result column="faultreasult" property="faultreasult" />
        <result column="status" property="status" />
        <result column="orderTime" property="orderTime" />
        <result column="stockDater" property="stockDater" />
        <result column="otherone" property="otherone" />
        <result column="othertwo" property="othertwo" />
        <result column="otherthree" property="otherthree" />
        <result column="otherfour" property="otherfour" />
        <result column="otherfive" property="otherfive" />
    </resultMap>
    <resultMap type="com.accp.domain.RepairAndRescue" id="BaseResultMap2" extends="BaseResultMap">
        <result column="number" property="number" jdbcType="VARCHAR" />
        <result column="clientname" property="clientname" jdbcType="VARCHAR" />
        <result column="carNumber" property="carNumber" jdbcType="VARCHAR" />
        <result column="clienttype" property="clienttype" jdbcType="VARCHAR" />
        <result column="phone" property="phone" jdbcType="VARCHAR" />
        <result column="tname" property="tname" jdbcType="VARCHAR" />
        <result column="carinfoId" property="carinfoid" jdbcType="INTEGER" />
        <result column="staffno" property="staffno" jdbcType="VARCHAR" />
        <result column="oil" property="oil" jdbcType="VARCHAR" />
        <result column="type" property="type" jdbcType="VARCHAR" />
        <result column="worktime" property="worktime" jdbcType="VARCHAR" />
        <result column="getman" property="getman" jdbcType="VARCHAR" />
        <result column="overworkdate" property="overworkdate" jdbcType="TIMESTAMP" />
        <result column="nowworkDate" property="nowworkdate" jdbcType="TIMESTAMP" />
        <result column="setter" property="setter" jdbcType="VARCHAR" />
        <result column="company" property="company" jdbcType="VARCHAR" />
        <result column="befor" property="befor" jdbcType="TIMESTAMP" />
        <result column="price" property="price" jdbcType="REAL" />
        <result column="remark" property="remark" jdbcType="VARCHAR" />
        <result column="state" property="state" jdbcType="VARCHAR" />
        <result column="fault" property="fault" jdbcType="VARCHAR" />
        <result column="faultreasult" property="faultreasult" jdbcType="VARCHAR" />
        <result column="status" property="status" jdbcType="VARCHAR" />
        <result column="orderTime" property="ordertime" jdbcType="TIMESTAMP" />
        <result column="stockDater" property="stockdater" jdbcType="TIMESTAMP" />
    </resultMap>
    <resultMap type="com.accp.domain.Repair" id="BaseResultPlus" extends="BaseResultMap">
        <result column="platename" property="carnumber" jdbcType="VARCHAR" />
        <result column="totalnum" property="totalnum" jdbcType="REAL" />
        <result column="cashiertime" property="cashiertime" jdbcType="TIMESTAMP" />
        <result column="staffname" property="staffname" jdbcType="VARCHAR" />
        <result column="paymenttype" property="paymenttype" jdbcType="VARCHAR" />
        <result column="wtype" property="wtype" jdbcType="VARCHAR" />
        <result column="carbrandname" property="carbrandname" jdbcType="VARCHAR" />
        <result column="clientname" property="clientname" jdbcType="VARCHAR" />
        <result column="cname" property="cartypename" jdbcType="VARCHAR" />
        <result column="framnum" property="carnumber1" jdbcType="VARCHAR" />
        <result column="driverphone" property="carerphone" jdbcType="VARCHAR" />
        <result column="cicompanyid" property="jqinsurance" jdbcType="VARCHAR" />
        <result column="staffpeople" property="staffpeople" jdbcType="VARCHAR" />
    </resultMap>
    <select id="selectSettleAccounts" resultMap="BaseResultPlus">
  	SELECT item.*,cashier.totalNum,cashier.cashiertime,
(SELECT yname FROM `yuangongziliaobiao` WHERE yid=staffid) staffpeople,cashier.paymentType FROM(SELECT repair.number,'维修' AS wtype,repair.setter,repair.status,
(SELECT brandname FROM carbrand WHERE carbrand.carcoding=car.carbrandid)carbrandname,customer.customername clientname,
car.platename,chexingdingyibiao.cname,car.framnum,car.driverphone,car.cicompanyid,(SELECT yname FROM yuangongziliaobiao WHERE yid=repair.`staffno` LIMIT 0,1) staffname,
repair.overworkdate,repair.`price`,repair.`orderTime`
 FROM REPAIR JOIN `car` ON car.carnum=repair.carinfoId
 LEFT JOIN `customer` ON customer.customernum=car.customernum
 LEFT JOIN `customertype` ON customertype.`customerid`=customer.`customertypeid`
 LEFT JOIN `chexingdingyibiao` ON chexingdingyibiao.`cid`=car.`carnum`
 UNION ALL
SELECT rescue.`number`,'救援' AS wtype,rescue.`setter`,rescue.status,(SELECT brandname FROM carbrand WHERE carbrand.`carcoding`=car.`carbrandid`)
 carbrandname,customer.customername clientname,car.platename,chexingdingyibiao.`cname`,car.`framnum`,car.`driverphone`,car.`cicompanyid`,
 (SELECT yname FROM yuangongziliaobiao WHERE yid=rescue.`staffno` LIMIT 0,1) staffname,
rescue.overtime,rescue.`price`,rescue.`orderTime`
 FROM rescue LEFT JOIN `car` ON car.carnum=rescue.carinfoId
 LEFT JOIN `chexingdingyibiao` ON chexingdingyibiao.`cid`=car.`carnum`
 LEFT JOIN `customer` ON customer.customernum=car.customernum
LEFT JOIN `customertype` ON customertype.`customerid`=customer.`customertypeid`) item LEFT JOIN cashier ON item.number=cashier.`Number`
  WHERE item.status LIKE '%完工%' ORDER BY item.overworkdate DESC
  </select>
    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        number, carinfoId, staffno, oil, type, worktime, getman, overworkdate, nowworkDate, setter, company, befor, price, remark, state, fault, faultreasult, status, orderTime, stockDater, otherone, othertwo, otherthree, otherfour, otherfive
    </sql>
    <select id="queryRepair" resultMap="BaseResultMap" >
        SELECT * FROM `repair` WHERE number=#{number}
    </select>
    <select id="selectSettleAccounts2" resultMap="BaseResultPlus">
SELECT item.*,cashier.totalNum,cashier.cashiertime,
(SELECT yname FROM `yuangongziliaobiao` WHERE yid=staffid) staffpeople,cashier.paymentType FROM(SELECT repair.number,'维修' AS wtype,repair.setter,repair.status,
(SELECT brandname FROM carbrand WHERE carbrand.carcoding=car.carbrandid)carbrandname,customer.customername clientname,
car.platename,chexingdingyibiao.cname,car.framnum,car.driverphone,car.cicompanyid,(SELECT yname FROM yuangongziliaobiao WHERE staffno=repair.`staffno` LIMIT 0,1) staffname,
repair.overworkdate,repair.`price`,repair.`orderTime`
 FROM REPAIR JOIN `car` ON car.carnum=repair.carinfoId
 LEFT JOIN `customer` ON customer.customernum=car.customernum
 LEFT JOIN `customertype` ON customertype.`customerid`=customer.`customertypeid`
 LEFT JOIN `chexingdingyibiao` ON chexingdingyibiao.`cid`=car.`carnum`
 UNION ALL
SELECT rescue.`number`,'救援' AS wtype,rescue.`setter`,rescue.status,(SELECT brandname FROM carbrand WHERE carbrand.`carcoding`=car.`carbrandid`)
 carbrandname,customer.customername clientname,car.platename,chexingdingyibiao.`cname`,car.`framnum`,car.`driverphone`,car.`cicompanyid`,
 (SELECT yname FROM yuangongziliaobiao WHERE yid=rescue.`staffno` LIMIT 0,1) staffname,
rescue.overtime,rescue.`price`,rescue.`orderTime`
 FROM rescue LEFT JOIN `car` ON car.carnum=rescue.carinfoId
 LEFT JOIN `chexingdingyibiao` ON chexingdingyibiao.`cid`=car.`carnum`
 LEFT JOIN `customer` ON customer.customernum=car.customernum
LEFT JOIN `customertype` ON customertype.`customerid`=customer.`customertypeid`) item
LEFT JOIN cashier ON item.number=cashier.`Number`
  WHERE item.number = #{number} OR item.platename = #{platename} OR item.orderTime BETWEEN #{startkd} AND #{endkd} AND item.status LIKE '%完工%' ORDER BY item.overworkdate DESC
    </select>
    <select id="selectRepairAndRescue" resultMap="BaseResultMap2">
  	select *from	(SELECT repair.status,repair.type,client.name clientname,carinfo.carNumber,client.phone,repair.number,'维修' AS tname,repair.orderTime,
repair.overworkdate,repair.nowworkDate,repair.stockDater,repair.price,staff.name,repair.getman,clienttype.clienttype
 FROM REPAIR JOIN `carinfo` ON carinfo.id=repair.carinfoId
left JOIN `staff` ON staff.staffNo=repair.staffno
 JOIN `client` ON client.number=carinfo.clientid
 join clientType on clienttype.id=client.typeid
 UNION ALL
 SELECT rescue.status,rescue.type,client.name clientname,carinfo.carNumber,client.phone,rescue.number,'救援' AS tname,rescue.orderTime,
rescue.nowdate,rescue.overtime,rescue.stockDater,rescue.price,staff.name,rescue.getman,clienttype.clienttype
 FROM rescue JOIN `carinfo` ON carinfo.id=rescue.carinfoId
 left JOIN `staff` ON staff.staffNo=rescue.staffno
 JOIN `client` ON client.number=carinfo.clientid
 join clientType on clienttype.id=client.typeid
 ) item
WHERE ${type} like '%${content}%' OR item.clientname LIKE '%${cpc}%'
OR item.carNumber LIKE '%${cpc}%' OR item.phone LIKE '%${cpc}%'
  </select>
</mapper>
