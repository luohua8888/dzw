<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.accp.mapper.RepairMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.accp.domain.Repair">
        <id column="number" property="number" />
        <result column="carinfoId" property="carinfoId" />
        <result column="staffno" property="staffno" />
        <result column="oil" property="oil" />
        <result column="type" property="type" />
        <result column="worktime" property="worktime" />
        <result column="getman" property="getman" />
        <result column="overworkdate" property="overworkdate" />
        <result column="nowworkDate" property="nowworkDate" />
        <result column="setter" property="setter" />
        <result column="company" property="company" />
        <result column="befor" property="befor" />
        <result column="price" property="price" />
        <result column="remark" property="remark" />
        <result column="state" property="state" />
        <result column="fault" property="fault" />
        <result column="faultreasult" property="faultreasult" />
        <result column="status" property="status" />
        <result column="orderTime" property="orderTime" />
        <result column="stockDater" property="stockDater" />
        <result column="otherone" property="otherone" />
        <result column="othertwo" property="othertwo" />
        <result column="otherthree" property="otherthree" />
        <result column="otherfour" property="otherfour" />
        <result column="otherfive" property="otherfive" />
    </resultMap>
    <resultMap type="com.accp.domain.RepairAndRescue" id="BaseResultMap2" extends="BaseResultMap">
        <result column="number" property="number" jdbcType="VARCHAR" />
        <result column="clientname" property="clientname" jdbcType="VARCHAR" />
        <result column="platename" property="platename" jdbcType="VARCHAR" />
        <result column="phone" property="phone" jdbcType="VARCHAR" />
        <result column="tname" property="tname" jdbcType="VARCHAR" />
        <result column="carinfoId" property="carinfoid" jdbcType="INTEGER" />
        <result column="staffno" property="staffno" jdbcType="VARCHAR" />
        <result column="oil" property="oil" jdbcType="VARCHAR" />
        <result column="type" property="type" jdbcType="VARCHAR" />
        <result column="worktime" property="worktime" jdbcType="VARCHAR" />
        <result column="getman" property="getman" jdbcType="VARCHAR" />
        <result column="overworkdate" property="overworkdate" jdbcType="TIMESTAMP" />
        <result column="nowworkDate" property="nowworkDate" jdbcType="TIMESTAMP" />
        <result column="setter" property="setter" jdbcType="VARCHAR" />
        <result column="company" property="company" jdbcType="VARCHAR" />
        <result column="befor" property="befor" jdbcType="TIMESTAMP" />
        <result column="price" property="price" jdbcType="REAL" />
        <result column="remark" property="remark" jdbcType="VARCHAR" />
        <result column="state" property="state" jdbcType="VARCHAR" />
        <result column="fault" property="fault" jdbcType="VARCHAR" />
        <result column="faultreasult" property="faultreasult" jdbcType="VARCHAR" />
        <result column="status" property="status" jdbcType="VARCHAR" />
        <result column="orderTime" property="orderTime" jdbcType="TIMESTAMP" />
        <result column="stockDater" property="stockDater" jdbcType="TIMESTAMP" />
    </resultMap>
    <resultMap type="com.accp.domain.MaintainHistary" id="BaseResultMap3" extends="BaseResultMap">
        <result column="number" property="number" jdbcType="VARCHAR" />
        <result column="name" property="name" jdbcType="VARCHAR" />
        <result column="id" property="id" jdbcType="INTEGER" />
        <result column="workhour" property="workhour" jdbcType="INTEGER" />
        <result column="fprice" property="fprice" jdbcType="REAL" />
        <result column="qprice" property="qprice" jdbcType="REAL" />
        <result column="hprice" property="hprice" jdbcType="REAL" />
        <result column="allprice" property="allprice" jdbcType="REAL" />
        <result column="id" property="id" jdbcType="INTEGER" />
        <result column="itemTypeName" property="itemTypeName" jdbcType="VARCHAR" />
        <result column="artisanClassName" property="artisanClassName" jdbcType="VARCHAR" />
        <result column="itemsName" property="itemsName" jdbcType="VARCHAR" />
        <result column="priceType" property="priceType" jdbcType="VARCHAR" />
        <result column="carNumber" property="carNumber" jdbcType="VARCHAR" />
        <result column="phone" property="phone" jdbcType="VARCHAR" />
        <result column="type" property="type" jdbcType="VARCHAR" />
        <result column="overworkdate" property="overworkdate" jdbcType="TIMESTAMP" />
        <result column="nowworkDate" property="nowworkDate" jdbcType="TIMESTAMP" />
        <result column="price" property="price" jdbcType="REAL" />
        <result column="faultreasult" property="faultreasult" jdbcType="VARCHAR" />
        <result column="llpeople" property="llpeople" jdbcType="VARCHAR" />
        <result column="llname" property="llname" jdbcType="VARCHAR" />
        <result column="dw" property="dw" jdbcType="VARCHAR" />
        <result column="lltype" property="lltype" jdbcType="VARCHAR" />
        <result column="itemname" property="itemname" jdbcType="VARCHAR" />
        <result column="count" property="count" jdbcType="INTEGER" />
        <result column="orderTime" property="orderTime" jdbcType="TIMESTAMP" />
        <result column="lldate" property="lldate" jdbcType="TIMESTAMP" />
        <result column="stockDater" property="stockDater" jdbcType="TIMESTAMP" />
    </resultMap>
    <resultMap type="com.accp.domain.MaintainHistary" id="BaseResultMap3" extends="BaseResultMap">
        <result column="number" property="number" jdbcType="VARCHAR" />
        <result column="name" property="name" jdbcType="VARCHAR" />
        <result column="id" property="id" jdbcType="INTEGER" />
        <result column="workhour" property="workhour" jdbcType="INTEGER" />
        <result column="fprice" property="fprice" jdbcType="REAL" />
        <result column="qprice" property="qprice" jdbcType="REAL" />
        <result column="hprice" property="hprice" jdbcType="REAL" />
        <result column="allprice" property="allprice" jdbcType="REAL" />
        <result column="id" property="id" jdbcType="INTEGER" />
        <result column="itemTypeName" property="itemTypeName" jdbcType="VARCHAR" />
        <result column="artisanClassName" property="artisanClassName" jdbcType="VARCHAR" />
        <result column="itemsName" property="itemsName" jdbcType="VARCHAR" />
        <result column="priceType" property="priceType" jdbcType="VARCHAR" />
        <result column="carNumber" property="carNumber" jdbcType="VARCHAR" />
        <result column="phone" property="phone" jdbcType="VARCHAR" />
        <result column="type" property="type" jdbcType="VARCHAR" />
        <result column="overworkdate" property="overworkdate" jdbcType="TIMESTAMP" />
        <result column="nowworkDate" property="nowworkdate" jdbcType="TIMESTAMP" />
        <result column="price" property="price" jdbcType="REAL" />
        <result column="faultreasult" property="faultreasult" jdbcType="VARCHAR" />
        <result column="llpeople" property="llpeople" jdbcType="VARCHAR" />
        <result column="llname" property="llname" jdbcType="VARCHAR" />
        <result column="dw" property="dw" jdbcType="VARCHAR" />
        <result column="lltype" property="lltype" jdbcType="VARCHAR" />
        <result column="itemname" property="itemname" jdbcType="VARCHAR" />
        <result column="count" property="count" jdbcType="INTEGER" />
        <result column="orderTime" property="ordertime" jdbcType="TIMESTAMP" />
        <result column="lldate" property="lldate" jdbcType="TIMESTAMP" />
        <result column="stockDater" property="stockdater" jdbcType="TIMESTAMP" />
    </resultMap>


    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        number, carinfoId, staffno, oil, type, worktime, getman, overworkdate, nowworkDate, setter, company, befor, price, remark, state, fault, faultreasult, status, orderTime, stockDater, otherone, othertwo, otherthree, otherfour, otherfive
    </sql>
    <select id="selectRepairItem" resultMap="BaseResultMap3">
SELECT carinfo.`carNumber`,client.`name`, repair.`number`,repair.`orderTime`,repair.type,repair.`nowworkDate`,repair.`stockDater`,item.id,item.itemsName,ir.priceType
,(TIMESTAMPDIFF(HOUR,repair.`orderTime`,repair.`stockDater`)) workhour,ir.fprice,artisanclass.`artisanClassName`,repair.`faultreasult` FROM`repair`
LEFT JOIN `item_repair` ir ON ir.wjid=repair.`number`
LEFT JOIN `maintenanceitems` item ON item.id=ir.itemid
LEFT JOIN`itemtype` TYPE ON type.id=item.typeid
LEFT JOIN `carinfo` ON carinfo.`id`=repair.`carinfoId`
LEFT JOIN `artisanclass` ON artisanclass.`id`=ir.teamid
LEFT JOIN CLIENT ON client.`number`=carinfo.`clientid`
WHERE ${type} like '%${content}%'
  </select>
    <select id="selectHistray" resultMap="BaseResultMap3">
        SELECT repair.`number`,repair.`orderTime`,repair.type,repair.`nowworkDate`,
        customer.`customername` AS `name`,car.`platename` AS carNumber,customer.`phone`,
        repair.`stockDater`,repair.`price` FROM`repair`
        LEFT JOIN `car` ON car.carnum=repair.`carinfoId`
        LEFT JOIN `customer` ON customer.`customernum`=car.`customernum`
        WHERE ${type} LIKE '%${content}%'
    </select>
    <select id="selectRepairAndRescue" resultMap="BaseResultMap2">
  	SELECT *FROM (SELECT repair.status,repair.type,customer.customername clientname,car.platename,customer.phone,
repair.number,'维修' AS tname,repair.orderTime,repair.overworkdate,repair.nowworkDate,repair.stockDater,repair.price,
yuangongziliaobiao.yname name,repair.getman FROM `repair`
LEFT  JOIN `car`ON car.carnum=repair.`carinfoId`
JOIN `yuangongziliaobiao` ON yuangongziliaobiao.yid=repair.staffno
 JOIN `customer` ON customer.customernum=car.customernum
 UNION ALL
 SELECT rescue.status,rescue.type,customer.customername clientname,
car.platename,customer.phone,rescue.number,'救援' AS tname,rescue.orderTime,
rescue.nowdate,rescue.overtime,rescue.stockDater,rescue.price,yuangongziliaobiao.yname name,rescue.getman
 FROM rescue
  LEFT JOIN `car` ON car.carnum=rescue.carinfoid
 JOIN `yuangongziliaobiao` ON yuangongziliaobiao.yid=rescue.staffno
 JOIN `customer` ON customer.customernum=car.customernum
 ) item
WHERE ${type} like '%${content}%' OR item.clientname LIKE '%${cpc}%'
OR item.platename LIKE '%${cpc}%' OR item.phone LIKE '%${cpc}%'
  </select>
</mapper>
